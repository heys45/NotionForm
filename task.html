<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="form.css">
    <title>Document</title>
</head>
<body>
    <p id="last-updated"></p>

    <script>
      // ページの最終更新日時を取得
      const lastUpdated = new Date(document.lastModified);
  
      // 現在の日時を取得
      const now = new Date();
  
      // 日時のフォーマットを設定
      const options = {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: 'numeric',
        minute: 'numeric',
        second: 'numeric',
        hour12: false
      };
  
      // 最終更新日時と現在日時を比較して表示
      if (lastUpdated.getTime() === 0) {
        document.getElementById("last-updated").innerHTML = "このページは更新されていません。";
      } else if (lastUpdated.getTime() === now.getTime()) {
        document.getElementById("last-updated").innerHTML = "このページは現在更新されています。";
      } else if (lastUpdated < now) {
        document.getElementById("last-updated").innerHTML = "このページは " + lastUpdated.toLocaleDateString("ja-JP", options) + " に更新されました。";
      }
    </script>


    <table>
        <tr>
            <th>タスク内容</th>
            <th>見積</th>
            <th>実工数</th>
            <th>進捗</th>
            <th>Task Detail</th>
            <th>クライアント</th>
            <th>作成日時</th>
        </tr>
        <tr>
            <td>スケ提出のガイド反映</td>
            <td>30</td>
            <td>null</td>
            <td>100</td>
            <td>null</td>
            <td>トモノカイ</td>
            <td>3/24/2023, 4:22:00 PM</td>
        </tr>
        <tr>
            <td>河内さん出勤フォーム表示</td>
            <td>30</td>
            <td>null</td>
            <td>60</td>
            <td>null</td>
            <td>トモノカイ</td>
            <td>3/24/2023, 2:53:00 PM</td>
        </tr>
        <tr>
            <td>会員DB移す</td>
            <td>30</td>
            <td>null</td>
            <td>null</td>
            <td>null</td>
            <td>トモノカイ</td>
            <td>3/24/2023, 2:47:00 PM</td>
        </tr>
        <tr>
            <td>個情追加フォーム</td>
            <td>10</td>
            <td>null</td>
            <td>null</td>
            <td>null</td>
            <td>トモノカイ</td>
            <td>3/24/2023, 2:45:00 PM</td>
        </tr>
        <tr>
            <td>水書さんページ修正</td>
            <td>10</td>
            <td>null</td>
            <td>20</td>
            <td>水書さんページ修正
                【合格の場合】
                ・講師｜シフト、勤怠ON
                ・教室｜シフト、勤怠、プロフON
                【不合格の場合】</td>
            <td>トモノカイ</td>
            <td>3/24/2023, 2:03:00 PM</td>
        </tr>
    </table>

    <form id="myForm" >
        <label for="title">タスク内容:</label><br>
        <input type="text" id="title" name="title"><br>
        <label for="estimation">見積:</label><br>
        <input type="number" id="estimation" name="number:見積"><br>
        <label for="actual">実工数:</label><br>
        <input type="number" id="actual" name="number:実工数"><br>
        <label for="progress">進捗:</label><br>
        <input type="number" id="progress" name="number:進捗"><br>
        <label for="taskDetail">Task Detail:</label><br>
        <input type="text" id="taskDetail" name="rich text:Task Detail"><br>
        <label for="client">クライアント:</label><br>
        <select id="client" name="select:クライアント">
          <option value="A社">A社</option>
          <option value="B社">B社</option>
          <option value="C社">C社</option>
        </select><br><br>
        <input type="submit" value="送信">
      </form>
      <script>
        // フォームの送信をハンドルする関数
        const handleSubmit = async (event) => {
          event.preventDefault(); // デフォルトの送信をキャンセル
          const form = document.querySelector('#myForm');
          const formData = new FormData(form);
          const data = {};
          // FormDataオブジェクトから連想配列に変換
          for (const [key, value] of formData.entries()) {
            data[key] = value;
          }


        // taskDetailを整形してdataに追加
        const now = new Date();
        const formattedDate = now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate();
        const formattedTime = now.getHours() + ":" + now.getMinutes() + ":" + now.getSeconds();
        const taskDetail = data["rich text:Task Detail"];
        const actual = data["number:実工数"];
        const formattedTaskDetail = `${actual} ${formattedDate} ${formattedTime}\n${taskDetail}`;
        data["rich text:Task Detail"] = formattedTaskDetail;

        const response = await fetch("https://script.google.com/macros/s/AKfycbyZQosu3WeC4dq-SWiU2yOrTJr1Gjea6s4EvjlfzuFKpADlPdTCojiENHreCnN5Nn86/exec", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json' // Content-Typeヘッダーを設定
        },
        body: JSON.stringify(data)
        });
          if (response.ok) {
            console.log('データが正常に送信されました');
            form.reset(); // フォームの入力値をリセット
          } else {
            console.log('データの送信に失敗しました');
          }
        };
        const form = document.querySelector('#myForm');
        form.addEventListener('submit', handleSubmit);
      </script>







</body>
</html>